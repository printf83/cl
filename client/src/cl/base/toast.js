"use strict";import*as core from"./core.js";import label from"./label.js";import msg from"./msg.js";import div from"./div.js";import strong from"./strong.js";import small from"./small.js";import btnclose from"./btnclose.js";const defaultOption={animate:!0,title:null,icon:null,close:!0,autohide:!0,delay:5e3,date:null,timer:!0,position:"top-0 end-0",elem:null,debug:!1};export default class toast extends div{_bs=null;_tmr=null;constructor(...e){super(),this.data=core.args([{rule:["string","string|string[]|cl|cl[]","debug"],fn:()=>{let t=core.getBaseIcon(e[0]);return t?{color:t.color,elem:new msg({weight:"sm",icon:{icon:t.icon,type:t.type},elem:e[1]}),debug:!0}:{color:e[0],elem:"string"==typeof e[1]?new msg({weight:"sm",elem:e[1]}):e[1],debug:!0}}},{rule:["string","string|string[]|cl|cl[]"],fn:()=>{let t=core.getBaseIcon(e[0]);return t?{color:t.color,elem:new msg({weight:"sm",icon:{icon:t.icon,type:t.type},elem:e[1]})}:{color:e[0],elem:"string"==typeof e[1]?new msg({weight:"sm",elem:e[1]}):e[1]}}},{rule:["string|string[]"],fn:()=>({elem:new msg({weight:"sm",elem:e[0]})})},{rule:["cl|cl[]"],fn:()=>({elem:e[0]})},{rule:["object|debug"],fn:()=>e[0]}],"toast",e)}get data(){return super.data}set data(e){if(e){e=core.extend({},defaultOption,e);let t=core.getBaseIcon(e.icon);t&&(e.icon=t.icon,e.color=e.color||t.color),e.date=e.date||new Date,e.id=e.id||core.UUID();let s=this.timercounter(new Date(e.date));void 0===e.icon&&(e.icon=core.setting.icon()),void 0===e.title&&(e.title=core.setting.title());let o=e.icon||e.title?new div({class:"toast-header",elem:[new strong({class:"me-auto",elem:new label({icon:e.icon,label:e.title})}),e.autohide?null:new small({id:`${e.id}-timer`,class:["text-muted","timer"],"data-cl-time":e.date,elem:s?s.msg:"Just now"}),e.close?new btnclose({dismiss:"toast"}):null]}):null,i=new div({class:"toast-body",elem:new div({display:"flex",alignItem:"stretch",elem:[new div({marginEnd:"auto",display:"flex",alignItem:"center",elem:e.elem}),e.icon||e.title||!e.close?null:new div({marginStart:2,elem:new btnclose({dismiss:"toast",marginY:1})})]})});delete(e=core.merge(e,{class:["toast",e.debug?"show":null],tabindex:-1,bgColor:e.color,textBgColor:e.color,"data-bs-animation":e.animate?"true":null,"data-bs-autohide":e.autohide?"true":"false","data-bs-delay":e.delay,"data-cl-position":e.position,elem:[o,i]})).animate,delete e.title,delete e.icon,delete e.close,delete e.autohide,delete e.delay,delete e.date,delete e.timer,delete e.position,delete e.debug,super.data=e}}get bs(){return this._bs}set bs(e){this._bs=e}get tmr(){return this._tmr}set tmr(e){this._tmr=e}show=()=>{let e=this.data["data-cl-position"],t=core.combineArray(["toast-container",e]," "),s=document.body.getElementsByClassName(t)[0];s&&0!==s.length||(core.appendChild(document.body,new div({position:"absolute","aria-live":"polite","aria-atomic":"true",zIndex:3,elem:new div({class:["toast-container",e],position:"fixed",padding:3})})),s=document.body.getElementsByClassName(t)[0]),core.appendChild(s,this),this.bs=new bootstrap.Toast(this.dom),this.tmr=this.dom.getElementsByClassName("timer")[0],this.tmr&&this.timer();let o=e=>{core.init(e.currentTarget)},i=e=>{let t=e.currentTarget;core.removeElement(t)};this.dom.addEventListener("shown.bs.toast",o,!1),this.dom.addEventListener("hidden.bs.toast",i,!1),core.setupEventListenerRemover("toast",this.dom,(()=>{core.deleteEventListener("toast",this.dom,(()=>{this.dom.removeEventListener("shown.bs.toast",o,!1),this.dom.removeEventListener("hidden.bs.toast",i,!1),this.bs.dispose(),this.tmr=null,this.bs=null,this.dom=null}))})),this.bs.show()};timercounter(e){var t=new Date,s=e,o=-1,i="Just now";if(t>s){var l=t.getTime()-s.getTime(),n=parseInt(l/1e3,10);if(n<1)o=1e3,i="Just now";else if(n>=1&&n<60)o=1e3,i=`${n} second${n>1?"s":""} ago`;else if(n>=60&&n<3600){o=6e4;let e=parseInt(n/60,10);i=`${e} minute${e>1?"s":""} ago`}else if(n>=3600&&n<86400){o=36e5;let e=parseInt(n/3600,10);i=`${e} hour${e>1?"s":""} ago`}else{o=-1;let e=parseInt(n/86400,10);i=`${e} day${e>1?"s":""} ago`}}return{next:o,msg:i}}timer(){if(this.tmr){let e=this.timercounter(new Date(this.tmr.dataset.clTime));e&&(this.tmr.innerHTML=e.msg,e.next>0&&setTimeout((()=>{this.timer()}),e.next))}else core.setting.DEBUG&&console.log("Toast timer stop")}static hide(e){bootstrap.Toast.getInstance(e)?.hide()}}