"use strict";import*as core from"./core.js";import h from"./h.js";import label from"./label.js";import button from"./button.js";import div from"./div.js";import btnclose from"./btnclose.js";import*as container from"./container.js";const fnInputOnEnter=e=>{if(e&&13===e.keyCode){let l=e.currentTarget;e.preventDefault(),e.stopPropagation();let t=l.closest("div.col")?.nextSibling?.getElementsByTagName("INPUT")[0];if(t&&"INPUT"===t.nodeName)t.focus();else{let e=l.closest("div.modal").getAttribute("id");document.getElementById(`${e}_btn_0`)?.dispatchEvent(new Event("click"))}}},defaultOption={attr:null,id:null,class:null,static:!0,title:void 0,icon:void 0,footer:null,button:null,animate:!0,scrollable:!0,center:!0,size:null,maxwidth:null,fullscreen:!1,focus:!0,align:null,color:null,textcolor:null,bordercolor:null,border:!0,bgcolor:null,dark:null,bodyclass:null,bodyminheight:null,backdropcolor:null,defautlbtncolor:"primary",divider:!0,centerbutton:!1,elem:null,onshow:null,onshown:null,onhide:null,onhidden:null,onhideprevented:null,debug:!1};export default class modal extends div{_bs=null;constructor(...e){super(...e)}get data(){return super.data}set data(e){if(e){e=core.extend({},defaultOption,e);let l=core.getBaseIcon(e.icon),t=e.defautlbtncolor;l&&(e.icon={icon:l.icon,type:l.type,color:l.color},t=l.color),e.id=e.id||core.UUID(),void 0===e.icon&&(e.icon=core.setting.icon()),void 0===e.title&&(e.title=core.setting.title());let o=e.icon||e.title?new div({border:e.divider?null:"bottom-0",class:["modal-header"],elem:[new h({level:5,class:"modal-title",elem:new label({icon:e.icon,label:e.title})}),new btnclose({dismiss:"modal"})]}):null,n=!!e.elem&&(Array.isArray(e.elem)?e.elem[0].hasOwnProperty("cltab"):e.elem.hasOwnProperty("cltab")),s=new div({class:["modal-body",e.bodyclass],minHeight:e.bodyminheight,padding:n?0:null,elem:e.elem}),r=e.footer?new div({float:"start",class:["footer-ctl"],elem:e.footer}):null,a=null;if(e.button){Array.isArray(e.button)||(e.button=[e.button]);let l=e.button.map(((l,o)=>{if(l.hasOwnProperty("cl"))return l;{let n={id:null,label:null,icon:null,color:null,class:null,click:null};return"string"==typeof l?n.label=l:n=l,n=core.extend({},{id:n.id,class:n.class,click:n.click,color:n.color,label:n.label,icon:n.icon},n),new button({id:n.id?n.id:`${e.id}_btn_${o}`,label:n.label,icon:n.icon,class:core.mergeClass(n.class,"btn-modal"),color:0===o?n.color?n.color:t:n.color?n.color:"transparent",textBgColor:0===o?n.color?n.color:t:n.color?n.color:e.color,"data-bs-dismiss":n.click instanceof Function?null:"modal",tabindex:o+1,click:e=>{e.stopPropagation();let l=e.currentTarget.closest(".modal");if("1"===e.currentTarget.getAttribute("tabindex"))core.validate(l,(t=>{if(t){let t=core.getValue(l);!1!==(!(n.click instanceof Function)||n.click(e.currentTarget,t))&&modal.hide(l)}}));else{let t=core.getValue(l);!1!==(!(n.click instanceof Function)||n.click(e.currentTarget,t))&&modal.hide(l)}}})}}));l&&!e.centerbutton&&(l=l.reverse()),a=e.centerbutton?new div({display:"grid",gutter:2,col:[12,"md-6"],marginX:"auto",elem:l}):new div({justifyContent:"end",elem:new container.stack(l)})}let i=null;(a||r)&&(i=e.centerbutton?new div({borderNone:e.divider?null:"top",class:["modal-footer"],elem:new div({gap:2,padding:0,class:"container-fluid",elem:[new div({row:!0,elem:new div({col:!0,elem:a})}),new div({row:!0,elem:new div({col:!0,elem:r})})]})}):new div({borderNone:e.divider?null:"top",class:["modal-footer"],elem:new div({padding:0,container:"fluid",elem:new div({row:!0,gap:0,alignItem:"center",elem:[new div({col:!0,elem:r}),new div({col:"auto",elem:a})]})})})),super.data={id:e.id,name:e.name,class:core.mergeClass(e.class,["modal",e.animate&&!e.debug&&"fade",e.debug?"cl-debug":"show"]),style:core.mergeStyle(e.style,e.debug?{display:"block",position:"static"}:null),tabindex:-1,"data-bs-backdrop":e.static?"static":null,"data-bs-keyboard":e.static?"false":"true","data-bs-focus":e.focus?"true":null,"data-bs-backdropcolor":e.backdropcolor?e.backdropcolor:null,"aria-hidden":e.debug?"false":"true","show.bs.modal":e.show,"shown.bs.modal":e.shown,"hide.bs.modal":e.hide,"hidden.bs.modal":e.hidden,"hidePrevented.bs.modal":e.hideprevented,bgColor:e.bgcolor,elem:new div({maxWidth:e.maxwidth,class:["modal-dialog",e.scrollable?"modal-dialog-scrollable":null,e.center?"modal-dialog-centered":null,core.multiClass(e.size,{format:"modal-$1"}),core.multiClass(e.fullscreen,{format:"modal-fullscreen-$1",formatTrue:"modal-fullscreen"})],elem:new div({textAlign:e.align,bgColor:e.color,textBgColor:e.color,borderColor:e.bordercolor,border:e.border,class:["modal-content"],elem:[o,s,i]})})}}}get bs(){return this._bs}set bs(e){this._bs=e}show=()=>{core.appendChild(document.body,this),this.bs=new bootstrap.Modal(this.dom);let e=[...document.getElementsByClassName("modal")];if(e&&e.length>0){let l=[];e.forEach((e=>{e.classList.contains("cl-debug")||l.push(e)})),l&&l.length>1&&(l[l.length-2].classList.remove("show"),"static"===l[l.length-2].dataset.bsBackdrop&&l[l.length-2].nextSibling?.classList.remove("show"))}let l=e=>{let l=document.getElementsByClassName("modal-backdrop");if(l){let t=e.currentTarget.getAttribute("data-bs-backdropcolor");t&&(l[0].classList.add(`bg-${t}`),l[0].classList.add("opacity-100"))}let t=e.currentTarget;core.init(t);let o=[].slice.call(t.getElementsByTagName("INPUT"),0),n=o?o[0]:null;n&&(n.focus(),o.forEach((e=>{e.addEventListener("keydown",fnInputOnEnter),core.setupEventListenerRemover("keydown",e,(()=>{core.deleteEventListener("keydown",e,(()=>{e.removeEventListener("keydown",fnInputOnEnter,!1)}))}))})))},t=e=>{let l=[...document.getElementsByClassName("modal")];if(l&&l.length>0){let e=[];l.forEach((l=>{l.classList.contains("cl-block")||e.push(l)})),e&&e.length>1&&(e[e.length-2].classList.add("show"),"static"===e[e.length-2].dataset.bsBackdrop&&e[e.length-2].nextSibling?.classList.add("show"))}let t=e.currentTarget;core.removeElement(t)};this.dom.addEventListener("shown.bs.modal",l,!1),this.dom.addEventListener("hidden.bs.modal",t,!1),core.setupEventListenerRemover("modal",this.dom,(()=>{core.deleteEventListener("modal",this.dom,(()=>{this.dom.removeEventListener("shown.bs.modal",l,!1),this.dom.removeEventListener("hidden.bs.modal",t,!1),this.bs.dispose(),this.bs=null,this.dom=null}))})),this.bs.show()};static hide(e){bootstrap.Modal.getInstance(e)?.hide()}}